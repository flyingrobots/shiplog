# üö¢ü™µ Shiplog `v0.2.0` ‚Äì ***The Cut of Your Jib***

üó£Ô∏è *Raise the colors and man the rigging!* 

This voyage delivers **new tools for wrapping commands**, **steering automation**, and a clear view of the **trust roster**. 

**Shiplog** has leveled up!

## üè¥‚Äç‚ò†Ô∏è Highlights

### ü™µ Logception

> Now you can¬†**automatically log the execution of any shell command**! Capture its exit code, duration, and output directly into your git journal, as structured data.

The new `git shiplog run` command wraps any command and captures its output (via tee) and _**automatically writes it straight into your repo**_. Yeah. *BOOM.* That just happened.

ü´≥
üé§

```bash
$ git shiplog run \
      --service deploy \
      --reason "Smoke test" \
      --region us-west-2 \
      --cluster prod-a \
      --namespace frontend \
      -- env printf hi
  hi
  Deploy: deploy <none> ‚Üí prod/us-west-2/prod-a/frontend
  Reason: Smoke test
  Status: SUCCESS (0s) @ 2025-09-30T02:14:18Z
  Seq:    7 (parent 1f6d81d, trust 217be22, anchor (none))
```

Inspecting the entry shows the structured run payload, down to the `argv`, `exit code`, `duration`, and whether a note was attached:

```bash
$ git shiplog show --json | jq '.run'
{
  "argv": ["env","printf","hi"],
  "cmd": "env printf hi",
  "exit_code": 0,
  "status": "success",
  "duration_s": 0,
  "started_at": "2025-09-30T02:14:18Z",
  "finished_at": "2025-09-30T02:14:18Z",
  "log_attached": true
}
```

If the wrapped command wrote output, you can find it, written as a **git note**, under `refs/_shiplog/notes/logs`:

```bash
$ git notes --ref=refs/_shiplog/notes/logs show HEAD
2025-09-30T02:14:18Z    stdout    hi
```

### ü§ñ Automation-Friendly Append ‚Äì `git shiplog append`

Post entries non-interactively with your own JSON payload, via flags or stdin.

```bash
$ printf '{"checks":{"canary":"green"}}' \
| git shiplog append \
        --env prod \
        --service deploy \
        --status success \
        --reason "Post-release smoke" \
        --json -
Record: deploy <none> ‚Üí prod/us-west-2/prod-a/deploy
Reason: Post-release smoke
Status: SUCCESS (0s) @ 2025-09-30T02:18:50Z
```

*BEHOLD*! The trailer merges your JSON alongside Shiplog‚Äôs own fields:

```bash
$ git shiplog show --json | jq '{status, why, checks}'
{
  "status": "success",
  "why": {
    "reason": "Post-release smoke",
    "ticket": null
  },
  "checks": {
    "canary": "green"
  }
}
```

No prompts, no manual environment variables. Just `--json` (or `--json-file payload.json`) and Shiplog does the heavy lifting. üí™ *AVAST!*

### ü§ù Trust Roster View ‚Äì `git shiplog trust show`

See who holds the keys (and export the raw trust JSON if needed).

```bash
$ git shiplog trust show
Trust ID: shiplog-trust-root
Threshold: 1
Allowed signers: 1
Maintainers:
- Shiplog Tester <shiplog-tester@example.com> [root]
Signers:
- shiplog-tester@example.com (ssh-ed25519)

$ git shiplog trust show --json | jq '{id, threshold, maintainers}'
{
  "id": "shiplog-trust-root",
  "threshold": 1,
  "maintainers": [
    {
      "name": "Shiplog Tester",
      "email": "shiplog-tester@example.com",
      "role": "root",
      "revoked": false
    }
  ]
}
```

Ahoy! The CLI displays a human-friendly table; `--json` returns the raw objects so you can audit trust state in tooling. Know thy crew.

### üìã Structured Entry Schema ‚Äì `docs/reference/json-schema.md`

üó∫Ô∏è Schema for downstream parsers.

The exact JSON schema  for journal trailers (including the run block) is now published. No need to guess ‚Äì *know* which fields to expect. Enums are no longer mysterious. 

See for yourself: `docs/reference/json-schema.md` 

---
## ‚öì Upgrade Notes

### ***No breaking changes!*** existing journals remain seaworthy.

> [!important] 
> **Attention Hook Authors:**¬†Custom hooks should continue merging your data rather than overwriting the existing JSON trailer.

- `git shiplog run`¬†and¬†`git shiplog append`¬†now populate¬†`SHIPLOG_EXTRA_JSON`¬†internally.¬†
- **Namespace** now ***defaults to the journal name*** when `SHIPLOG_NAMESPACE` isn‚Äôt set (e.g., writing to ‚Äústaging‚Äù yields namespace ‚Äústaging‚Äù).

---

## üß≠ Thanks

*Ahoy* to **@coderabbitai** thank you for keeping a sharp eye on the code, and to everyone who tried it out and gave feedback.

---

## üçæ All hands, make sail!

Anchors aweigh! Time to cast off the lines and set her on course! The sails are set, the colors raised, and the git journal is your logbook, waiting for ink. 

`v0.2.0` is out, and like the ***cut of your jib,*** it‚Äôs sharp! From the crow‚Äôs nest, you can spy the seas ahead, whether you know your knots or still call starboard ‚Äúthe other side.‚Äù

### Sailor‚Äôs proverb

> ‚õµÔ∏è *Red sky at night, sailor‚Äôs delight; red sky in the morning, you‚Äôll be glad **Shiplog saved the warnings.***

Set sail with `v0.2.0` and log your next maneuver! ***Shiplog*** will keep the journal true, the wind in your sails, and will be your source of truth, even when the waves get rough.
